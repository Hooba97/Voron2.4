[gcode_macro SET_SOAK_TIME]
description: Set the default bed heat soak time in seconds.
gcode:
  {% set time = params.TIME|default(printer.gcode_macro.soak_time_duration|default(300))|int %}
  SAVE_VARIABLE VARIABLE=soak_time_duration VALUE={time}
  M118 Soak time set to {time} seconds.
  SET_DISPLAY_TEXT MSG="Soak Time: {time}s"

# --- Initial Variable Setup (Optional, but recommended) ---
# This macro ensures the 'soak_time_duration' variable is initialized upon Klipper startup
# if it hasn't been saved before. Run this once manually (e.g., after initial setup)
# or add it to your printer.cfg's END_GCODE or a start-up script.
[gcode_macro _INITIALIZE_SOAK_TIME_VARIABLE]
gcode:
  {% if not 'soak_time_duration' in printer.gcode_macro %}
    SAVE_VARIABLE VARIABLE=soak_time_duration VALUE=300
    M118 Initializing soak_time_duration to 300 seconds (5 minutes).
  {% endif %}